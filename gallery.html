<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ギャラリー | konmari</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Zen+Maru+Gothic:wght@400;500;700&family=Inter:ital,wght@0,300;0,400;0,600;0,700;1,300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<div class="scroll-indicator" id="scrollBar"></div>

<!-- NAV -->
<nav id="mainNav">
  <a href="index.html" class="nav-logo">kon<span>mari</span></a>
  <ul class="nav-links">
    <li><a href="index.html">ホーム</a></li>
    <li><a href="works.html">制作実績</a></li>
    <li><a href="gallery.html" class="active">ギャラリー</a></li>
    <li><a href="index.html#speaking-wrap">登壇履歴</a></li>
    <li><a href="https://note.com/konmari" target="_blank" rel="noopener">note</a></li>
  </ul>
  <a href="https://x.com/konmari_tweet" target="_blank" rel="noopener" class="nav-cta">X でフォロー</a>
</nav>

<!-- PAGE HERO -->
<section class="page-hero">
  <div class="page-hero-blob page-hero-blob-1"></div>
  <div class="page-hero-blob page-hero-blob-2"></div>
  <span class="page-hero-eyebrow fi">
    <span class="material-icons">photo_library</span>
    Gallery
  </span>
  <h1 class="fi delay-1">生成した画像、<span class="accent">全部見せます。</span></h1>
  <p class="fi delay-2">
    Midjourney / niji・journey で制作した作品をまとめています。<br>
    実写・フォトリアルとイラスト・アニメ、2ジャンルで掲載中。
  </p>
</section>

<!-- Wave -->
<div class="wave" style="background:var(--white);">
  <svg viewBox="0 0 1440 90" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
    <path d="M0,45 C180,90 360,5 540,45 C720,85 900,10 1080,45 C1200,68 1360,28 1440,42 L1440,90 L0,90 Z" fill="#f9f5f0"/>
  </svg>
</div>

<!-- GALLERY -->
<div id="gallery-wrap">
  <div class="section-inner">
    <p class="section-eyebrow fi">ギャラリー</p>
    <h2 class="section-title fi delay-1">Midjourneyで<span class="accent">作ってみたもの。</span></h2>
    <p class="section-lead fi delay-2">実写・フォトリアルと、イラスト・アニメに分けて掲載しています。<br>画像は随時追加中です。</p>

    <!-- タブ -->
    <div class="gallery-tabs fi delay-2">
      <button class="tab-btn active" data-tab="photo">
        <span class="material-icons">photo_camera</span>
        実写・フォト
      </button>
      <button class="tab-btn" data-tab="illust">
        <span class="material-icons">brush</span>
        イラスト・アニメ
      </button>
    </div>

    <!-- 実写・フォトタブ -->
    <div class="gallery-panel active" id="tab-photo">
      <div class="gallery-grid" id="grid-photo"></div>
    </div>

    <!-- イラスト・アニメタブ -->
    <div class="gallery-panel" id="tab-illust">
      <div class="gallery-grid" id="grid-illust"></div>
    </div>

    <p class="gallery-add-hint fi">
      画像は随時追加しています。
      <a href="https://x.com/konmari_tweet" target="_blank" rel="noopener">X (@konmari_tweet)</a>
      で最新の生成画像を先行公開中。
    </p>
  </div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="画像拡大表示">
  <div class="lb-backdrop" id="lbBackdrop"></div>
  <div class="lb-container">
    <button class="lb-close" id="lbClose" aria-label="閉じる">
      <span class="material-icons">close</span>
    </button>
    <div class="lb-img-wrap" id="lbImgWrap">
      <img id="lbImg" src="" alt="" draggable="false">
      <div class="lb-wm" aria-hidden="true"></div>
    </div>
    <button class="lb-prev" id="lbPrev" aria-label="前の画像">
      <span class="material-icons">chevron_left</span>
    </button>
    <button class="lb-next" id="lbNext" aria-label="次の画像">
      <span class="material-icons">chevron_right</span>
    </button>
  </div>
</div>

<!-- Footer -->
<footer>
  <a href="index.html" class="footer-logo">kon<span>mari</span></a>
  <p>© 2026 konmari (@konmari_tweet). All rights reserved.</p>
  <ul class="footer-links">
    <li><a href="index.html#about-wrap">About</a></li>
    <li><a href="works.html">Works</a></li>
    <li><a href="gallery.html">Gallery</a></li>
    <li><a href="index.html#speaking-wrap">登壇</a></li>
    <li><a href="https://note.com/konmari" target="_blank" rel="noopener">note</a></li>
    <li><a href="https://x.com/konmari_tweet" target="_blank" rel="noopener">X</a></li>
  </ul>
</footer>

<script>
// スクロールプログレスバー
const scrollBar = document.getElementById('scrollBar');
window.addEventListener('scroll', () => {
  const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
  scrollBar.style.width = scrolled + '%';
}, { passive: true });

// Nav scroll
const mainNav = document.getElementById('mainNav');
window.addEventListener('scroll', () => {
  mainNav.classList.toggle('scrolled', window.scrollY > 40);
}, { passive: true });

// ━━━ ギャラリー ━━━
let allItems = [];        // 全画像リスト（tab付き）
let currentTab = 'photo'; // 表示中タブ
let currentIndex = 0;     // ライトボックスの現在位置

// ラベルなし・クリックでライトボックス開くアイテムを生成
function renderGalleryItem(item, globalIndex) {
  const div = document.createElement('div');
  div.className = 'gallery-item';
  div.dataset.index = globalIndex;
  div.innerHTML = `
    <img src="${item.src}" alt=""
         draggable="false"
         onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
    <div class="gallery-item-ph" style="display:none;"><span class="material-icons">image</span></div>`;
  div.addEventListener('click', () => openLightbox(globalIndex));
  return div;
}

fetch('gallery-data.json')
  .then(r => r.json())
  .then(data => {
    allItems = data.items;
    const photoGrid  = document.getElementById('grid-photo');
    const illustGrid = document.getElementById('grid-illust');
    data.items.forEach((item, i) => {
      const el = renderGalleryItem(item, i);
      (item.tab === 'illust' ? illustGrid : photoGrid).appendChild(el);
    });
  })
  .catch(() => {
    document.getElementById('grid-photo').innerHTML =
      '<p style="color:#aaa;padding:24px;">gallery-data.json が見つかりません。<br>node generate-gallery.js を実行してください。</p>';
  });

// Gallery tabs
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.gallery-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    currentTab = btn.dataset.tab;
    document.getElementById('tab-' + currentTab).classList.add('active');
  });
});

// ━━━ ライトボックス ━━━
const lightbox  = document.getElementById('lightbox');
const lbImg     = document.getElementById('lbImg');
const lbBackdrop = document.getElementById('lbBackdrop');
const lbClose   = document.getElementById('lbClose');
const lbPrev    = document.getElementById('lbPrev');
const lbNext    = document.getElementById('lbNext');

function getTabItems() {
  return allItems.map((item, i) => ({ ...item, globalIndex: i }))
                 .filter(item => item.tab === currentTab);
}

function openLightbox(globalIndex) {
  const tabItems = getTabItems();
  const pos = tabItems.findIndex(item => item.globalIndex === globalIndex);
  currentIndex = pos >= 0 ? pos : 0;
  showImage(tabItems);
  lightbox.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  lightbox.classList.remove('open');
  document.body.style.overflow = '';
  lbImg.src = '';
}

function showImage(tabItems) {
  const item = tabItems[currentIndex];
  if (!item) return;
  lbImg.src = item.src;
  lbPrev.style.visibility = currentIndex > 0 ? 'visible' : 'hidden';
  lbNext.style.visibility = currentIndex < tabItems.length - 1 ? 'visible' : 'hidden';
}

lbClose.addEventListener('click', closeLightbox);
lbBackdrop.addEventListener('click', closeLightbox);

lbPrev.addEventListener('click', () => {
  const tabItems = getTabItems();
  if (currentIndex > 0) { currentIndex--; showImage(tabItems); }
});

lbNext.addEventListener('click', () => {
  const tabItems = getTabItems();
  if (currentIndex < tabItems.length - 1) { currentIndex++; showImage(tabItems); }
});

document.addEventListener('keydown', e => {
  if (!lightbox.classList.contains('open')) return;
  const tabItems = getTabItems();
  if (e.key === 'Escape')      closeLightbox();
  if (e.key === 'ArrowLeft'  && currentIndex > 0)                     { currentIndex--; showImage(tabItems); }
  if (e.key === 'ArrowRight' && currentIndex < tabItems.length - 1)   { currentIndex++; showImage(tabItems); }
});

// ━━━ ダウンロード保護 ━━━
// 右クリック無効
lightbox.addEventListener('contextmenu', e => e.preventDefault());
document.getElementById('gallery-wrap').addEventListener('contextmenu', e => e.preventDefault());
// ドラッグ無効
document.addEventListener('dragstart', e => {
  if (e.target.tagName === 'IMG') e.preventDefault();
});

// ━━━ Fade-in ━━━
document.addEventListener('DOMContentLoaded', () => {
  const items = Array.from(document.querySelectorAll('.fi'));
  const show = el => el.classList.add('visible');
  if (!('IntersectionObserver' in window)) { items.forEach(show); return; }
  const io = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) { show(entry.target); observer.unobserve(entry.target); }
    });
  }, { threshold: 0.06 });
  items.forEach(el => {
    const rect = el.getBoundingClientRect();
    if (rect.top < window.innerHeight * 0.92) show(el);
    else io.observe(el);
  });
});
</script>
</body>
</html>
